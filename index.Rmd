---
title       : Technical bias
author      : Michael Love
job         : Irizarry group, DFCI/HSPH
framework   : revealjs
revealjs:
  transition  : linear
  theme       : solarized
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow      # 
widgets     : [mathjax]            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
knit        : slidify::knit2slides
---

## Technical bias in sequencing data

Michael Love

Research Fellow

Irizarry group, DFCI/HSPH

--- &vertical

## Bias

<img src="figure/ruler.jpg">

***

<img src="figure/pothole.jpg">

thought experiment: measure potholes in Boston vs Cambridge

1. everyone's rulers are off by +1 cm
2. Boston rulers left in the sun, stretched by +1 cm

***

1. bias cancels out
2. bias is correlated with comparison of interest

<br><br>

.fragment ...sounds simple, but still we see datasets with 100%
confounding of condition with experimental batch

---

## "Sequencing bias"

* this talk: bias in use of sequencing as a *quantitative* assay
* there is also bias in sequencing, e.g. calling bases A,C,G,T

--- &vertical

## Example 1: DNA sequencing

* we are sequencing DNA for genotyping
* meanwhile, use data to find copy number

***

## Copy number

<img src="figure/cnv_diagram.jpg">

relative to a reference genome

***

### DNA sequencing

<a href="http://www.nature.com/nbt/journal/v26/n10/full/nbt1486.html">
<img height=500 src="figure/shendure.png">
</a>

* colonies of identical molecules
* one "read" per colony/spot

***

<img height=600 src="figure/illumina1.png">

***

<img height=600 src="figure/illumina2.png">

***

<img height=600 src="figure/illumina3.png">

***

## Reads stored in "Fastq" file

<img src="figure/fastq.jpg">

***

## Align reads to reference genome

<img src="figure/tview.png">

the local number of reads: "read depth"

***

## Local read depth

changes in read depth relative to a reference:

<img src="figure/yoon.png">

[Yoon et al 2009](http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3378858)

***

## Assumptions

* sample / reference is ok
* different rates of coverage?

***

## Amplification

involves polymerase copying DNA many times over

<a href="http://www.rcsb.org/pdb/101/motm.do?momID=40">
<img src="figure/polymerase.jpg">
</a>

has a preference for balance of C,G over A,T ...

--- &vertical

## Observing GC bias

1. partition the genome into windows
2. count the number of reads
3. calculate the ratio (C+G)/(A+C+G+T)

***

## Differential GC bias
 
<img src="figure/boeva.jpg">

[Boeva 2010](http://bioinformatics.oxfordjournals.org/content/27/2/268.long)

***

<img src="figure/benjamini1.png">

[Benjamini and Speed 2012](http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3378858)

***

<img src="figure/benjamini2.png">

[Benjamini and Speed 2012](http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3378858)

***

## Correction

<br>

* divide counts by prediction from model: $\frac{x}{\hat{\mu}_x}$
* .fragment then look at ratio of corrected counts
* .fragment alternatively, put $\hat{\mu}_x$ in the model

***

## Summary 1

* GC bias was *different* between sample and reference
* .fragment bias didn't cancel
* .fragment modeling on features we generated *in silico* helped

--- &vertical

## Example 2: RNA sequencing

* we want to quantify mRNA and compare across patients
* needed for research and treatment: as a marker, diagnostics

***

## RNA sequencing protocol

<a href="http://www.sciencedirect.com/science/article/pii/S0014482714000160">
<img src="figure/vandijk.jpg">
</a>

***

## a few sources of bias

* fragmentation and size selection
* primer ligation
* PCR

<br>

.fragment (other steps are certainly also important)

***

[Hansen 2010](http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2896536/)

[Evans, Hower and Pachter 2010](http://www.biomedcentral.com/1471-2105/11/430/)

[Roberts 2011](http://genomebiology.com/2011/12/3/R22)

[Zheng, Chung and Zhao 2011](http://www.biomedcentral.com/1471-2105/12/290)

--- &vertical

## Correcting bias at the gene level

* Conditional quantile normalization (cqn)
* Surrogate variable analysis (sva)
* add batch to model formula

***

### conditional quantile normalization

<img height=500 src="figure/cqn.jpg">

[Hansen 2011](http://biostatistics.oxfordjournals.org/content/13/2/204.full)

***

### Bias in batches

<img src="figure/bottomly_batch.png">

***

### Surrogate variable analysis

<img height=500 src="figure/sva.png">

SVA: [Leek 2007](http://www.plosgenetics.org/article/info%3Adoi%2F10.1371%2Fjournal.pgen.0030161),
svaseq: [Leek 2014](http://nar.oxfordjournals.org/content/early/2014/10/07/nar.gku864.abstract)

***

## Bioconductor packages

* [cqn](http://www.bioconductor.org/packages/release/bioc/html/cqn.html)
* [EDASeq](http://www.bioconductor.org/packages/release/bioc/html/EDASeq.html)
* [sva](http://www.bioconductor.org/packages/release/bioc/html/sva.html)
* [RUVseq](http://www.bioconductor.org/packages/release/bioc/html/RUVseq.html)

***

## Add batch to the model

<br>

Per gene, model the mean for sample j, $\mu_j$, as:

<br>

$$ log(\mu_j) = \beta_0 + \beta_{b} 1_{j \in B} + \beta_{t} 1_{j \in T} $$

<br>

where *B* is the second batch, *T* is the treated samples.

